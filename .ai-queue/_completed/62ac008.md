# Commit History

- `480745f` — docs: unified component spec format and quality baseline
- `62ac008` — merge commit into main

Note: Tasks 003 and 004 were already completed. Reconciled by keeping
their constitution changes and adding the new governance sections on top.

---

<!-- auto-queue -->
# Design Unified Component Spec Format + Update Constitutions

## Context

This project currently uses **two** markdown governance files per component:
- `*.spec.md` — UX intent, behavioral rules, accessibility requirements, test plan
- `*.contract.md` — Public API (prop tables), behavioral guarantees, breaking change criteria

**Problems with the dual-file approach:**
1. **Prop/API duplication**: Contract files contain full prop tables with TypeScript types and defaults — this duplicates what TypeScript already provides via interfaces and default values. Maintaining the same information in two places invites drift.
2. **Content overlap**: ~30% of content appears in both files (interaction states, accessibility attributes, theming rules).
3. **Cognitive overhead**: Two files per component is a lot of governance surface. Contributors must check both.
4. **Low coverage incentive**: With 40 files needed for 20 components (and 37 components having zero files), the barrier to full coverage is high.

**Decision: Merge spec and contract into a single unified `*.spec.md` file.**

## Conflict Note

**Tasks 003 and 004 in the queue should be DELETED before this task runs.** They modify constitutions and create contract files in a way that conflicts with this new approach:
- Task 003 adds front-of-frontend rules to constitutions — this task ABSORBS that work
- Task 004 creates `FRONTEND_QUALITY.contract.md` — this task replaces that concept with a unified quality spec
- Task 005 depends on 003+004 — after deleting 003/004, update 005's `depends-on` to reference this task (007) instead

If 003 or 004 have already been completed and merged when this task runs, the executing agent must reconcile (merge their constitution changes into the unified approach rather than reverting them).

## Deliverables

### 1. Create Unified Spec Template

Create `packages/_templates/component.spec.template.md` with this structure:

```markdown
# Component Spec — {ComponentName}

> **Baseline**: This component must satisfy all requirements in [`QUALITY_BASELINE.md`](../QUALITY_BASELINE.md).

## 1. Purpose
- What this component is for
- When to use it
- When NOT to use it (anti-patterns)

## 2. UX Intent
- User mental model
- Applicable UX laws (Jakob's, Fitts's, Hick's, Tesler's, Doherty, Gestalt, Peak-End — cite only those relevant)

## 3. Anatomy
- Sub-components and their roles (e.g., Button.Text, Button.Icon)
- Required vs optional parts
- NO prop tables — reference TypeScript: "See `ButtonProps` in `Button.tsx` for the full typed API"

## 4. Behavior
### States
- List all states (idle, hover, focus, active, disabled, loading, error, etc.)
- Describe visual and functional behavior for each

### Keyboard Interaction
- Which keys do what (Tab, Enter, Space, Escape, Arrow keys)
- Reference WAI-ARIA APG pattern if applicable

## 5. Accessibility
- Required ARIA attributes (with rationale)
- Focus management rules
- Screen reader announcements
- Contrast requirements (reference QUALITY_BASELINE.md for standard ratios)

## 6. Styling
- Which design tokens are used and why
- Responsive behavior
- Reduced motion handling
- Dark mode considerations

## 7. Composition
- What can contain this component
- What this component can contain
- Anti-patterns

## 8. Breaking Change Criteria
- What constitutes a breaking change for this component
- (Moved from contract.md — this is the versioning boundary)

## 9. Test Requirements
- Behavioral tests (what to assert)
- Accessibility tests (ARIA, keyboard, focus)
- Visual regression considerations
```

**Key differences from current approach:**
- **No prop tables** — TypeScript is the source of truth for types, defaults, and required/optional. The spec says "See `ComponentProps` in `Component.tsx`" instead.
- **Single file** — Merges the best of both spec and contract.
- **Anatomy section** replaces the contract's "Public API" — describes structure without duplicating types.
- **Breaking Change Criteria** moved from contract into this file.
- **UX Intent preserved** — The spec's UX law references are valuable and unique.

### 2. Create Shared Quality Baseline

Create `packages/QUALITY_BASELINE.md` (replaces the `FRONTEND_QUALITY.contract.md` concept from task 004):

This document defines the **universal quality requirements** that every component must meet. Individual component specs reference this as their baseline.

Include:

**Semantic HTML:**
- Interactive components must render the correct native HTML element (`<button>`, `<input>`, `<select>`, etc.) — never a `<div>` with ARIA role patching
- In Tamagui: use `styledHtml()` for semantic elements, NOT `styled(View, { tag: 'button' })`
- Container components should use appropriate sectioning/landmark elements where applicable
- Text components must use the correct element (`<p>`, `<h1>`–`<h6>`, `<span>`, `<label>`, etc.)

**DOM Structure:**
- Maximum 3 levels of nesting within a component's rendered output (excluding consumer-passed children)
- No element may exist solely to apply a single CSS property that could be on an existing element
- Sub-components must not introduce wrapper elements beyond the styled element itself

**Accessibility (WCAG 2.2 AA):**
- All interactive elements keyboard-operable
- Visible focus: 2px solid outline, 2px offset, `$color10`, 3:1 contrast against adjacent colors
- Text contrast: 4.5:1 normal, 3:1 large (WCAG 1.4.3)
- Non-text contrast: 3:1 for UI boundaries and states (WCAG 1.4.11)
- Touch targets: minimum 24x24px (WCAG 2.5.8), recommended 44x44px
- Form controls: visible associated `<label>`, `aria-invalid` on error, `aria-describedby` for helper/error text
- Reduced motion: respect `prefers-reduced-motion`

**Token Discipline:**
- All colors, spacing, font sizes, radii through design tokens — zero hardcoded values
- Standard focus style pattern: `focusVisibleStyle: { outlineWidth: 2, outlineOffset: 1, outlineColor: '$color10', outlineStyle: 'solid' }`
- Press/hover styles use token-based colors and `animation: 'fast'`

**Verification Protocol:**
After creating or modifying ANY component:
1. Run AccessLint `audit_html` on representative rendered HTML
2. Verify DOM nesting depth (≤3 levels)
3. Confirm all interactive elements are keyboard-accessible
4. If colors changed, check contrast with AccessLint

### 3. Update AI_CONSTITUTION.md

Add the following changes (absorbing the intent of task 003):

**Add §2.8 Semantic HTML & DOM Structure:**
- Interactive elements: use `<button>` for actions, `<a>` for navigation — never `<div>` with onClick
- Headings: `<h1>`–`<h6>` in logical order, never skip levels
- Forms: every `<input>` has a `<label>`, use `<form>`, `<fieldset>`, `<legend>`
- Lists: `<ul>`/`<ol>` for lists, not stacked `<div>`s
- Tables: `<table>`, `<thead>`, `<tbody>`, `<th>`, `<td>` for tabular data
- Landmarks: `<header>`, `<nav>`, `<main>`, `<aside>`, `<footer>`
- DOM optimization: no styling-only wrappers, minimal nesting, audit rendered output
- Tamagui-specific: `tag` prop doesn't change element — use `styledHtml()` or native elements

**Update §3 Component Design Standards — add §3.5 Component Governance:**
- Every component, primitive, hook, and utility MUST have a `*.spec.md` file
- The spec file is the single source of behavioral truth — there is no separate contract file
- Specs must NOT duplicate TypeScript type information — reference the TypeScript source instead
- All specs must reference `packages/QUALITY_BASELINE.md` as their baseline
- A spec template is available at `packages/_templates/component.spec.template.md`

**Update §4 Testing Standards:**
- Every component with a `*.spec.md` MUST have a corresponding `*.test.tsx` file
- Tests must cover the requirements listed in the spec's "Test Requirements" section
- Test files live alongside their component (e.g., `Button/Button.test.tsx`)

### 4. Update DESIGN_CONSTITUTION.md

Absorbing the intent of task 003:

**Add §4.6 Contrast Verification:**
- Normal text: 4.5:1 (WCAG 1.4.3)
- Large text: 3:1
- UI components: 3:1 (WCAG 1.4.11)
- Focus indicators: 3:1 against adjacent colors (WCAG 2.4.11)
- Verification: use AccessLint MCP

**Add §4.7 Touch Target Sizing:**
- Minimum: 24x24 CSS pixels (WCAG 2.5.8)
- Recommended: 44x44 for primary actions
- Inline text links exempt

**Add §8.1 Spacing & Alignment Discipline:**
- All spacing via tokens (`$0.5`–`$10`)
- No hardcoded pixel values
- Gestalt proximity for grouping
- Intentional alignment (no "close enough")

**Add §8.2 DOM Structure Quality:**
- Minimum elements necessary
- No styling-only wrapper elements
- Audit rendered output in browser DevTools

**Update §6 Component Design Requirements:**
- Add: "Every component must have a `*.spec.md` governance file following the unified template"
- Add: "Specs must not duplicate TypeScript type definitions — reference the source code instead"
- Remove any references to separate contract files

## Scope
- **Creates**: `packages/_templates/component.spec.template.md`, `packages/QUALITY_BASELINE.md`
- **Modifies**: `AI_CONSTITUTION.md`, `DESIGN_CONSTITUTION.md`
- **Does NOT modify**: any component source code, existing spec/contract files, or test files

## Important Notes
- Preserve all existing constitution content — only ADD new sections and update references
- Match the existing tone and formatting
- Be concrete and actionable (not vague platitudes)
- Include brief "why" rationale for each rule
