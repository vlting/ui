# Commit History

| Hash | Message |
|------|---------|
| `d250be3` | feat(layout): implement AppShell, Sidebar, TopNav, BottomTabs, Drawer, CommandPalette, PageHeader |
| `d25f0eb` | feat(layout): implement Section, Card, StatCard, MetricTile |
| `2f19103` | feat(layout): implement DataTable, DataGrid, VirtualizedList, Pagination |
| `a6c3e4b` | feat(layout): implement Breadcrumbs, Tabs, Accordion |
| `4d54b0b` | feat(layout): implement ResizablePanel and SplitView |

---

# Implement `src/layout` Components

## Context

The `src/layout` module contains 20 components, all currently empty stubs. Each component has a
`.spec.md` (behaviour contract), a `.contract.md` (prop/API contract), and a `.test.tsx` (test
shell) already in place.

This task implements every component from stub → production-ready, following the specs strictly.

### Governing docs to read before touching any file

- `AI_CONSTITUTION.md` (repo root) — no business logic, presentation-only, accessibility mandatory
- `DESIGN_CONSTITUTION.md` (repo root) — UX laws, token discipline, familiar patterns
- Each component's `.spec.md` and `.contract.md` before implementing that component

---

## Implementation Rules

1. **All styling via design tokens.** No hardcoded colors, spacing, radii, or shadows.
2. **No business logic.** Components are presentation-only; no routing, no auth, no data fetching.
3. **Accessibility is mandatory.** Landmark roles, ARIA attributes, keyboard navigation, focus
   management, and reduced-motion support as specified in each `.spec.md`.
4. **Controlled + uncontrolled** patterns where the spec calls for both.
5. **Compound pattern** (`withStaticProperties`) for components with sub-parts.
6. **Tamagui v2 RC** conventions:
   - Do NOT use `createMedia` — plain object with `as const`
   - Omit `name` from `styled()` calls
   - Use `type` intersections, not `interface extends GetProps<>`
   - Palette arrays must be `string[]` not `readonly string[]`
7. **Test each component** by filling in the existing `.test.tsx` shell to cover all scenarios
   listed in section 9 of that component's `.spec.md`.

---

## Components to Implement

Work through these in order. For each component:

1. Read its `.spec.md` and `.contract.md`
2. Replace the stub `.tsx` with a real implementation
3. Update `.test.tsx` with meaningful tests
4. Commit incrementally (one commit per component or logical group)

### Group A — Shell & Navigation (implement first — others may compose these)

#### 1. `AppShell`
- Compound: `AppShell`, `AppShell.Header`, `AppShell.Sidebar`, `AppShell.Content`, `AppShell.Footer`
- Full-viewport-height frame; regions use landmark roles: `header`, `nav`, `main`, `footer`
- Sidebar collapse/expand: controlled (`sidebarOpen` + `onSidebarChange`) and uncontrolled
- On small viewports, sidebar renders as overlay with focus trap; Escape closes it
- Slide transition for sidebar open/close suppressed under reduced motion
- Each region independently memoized

#### 2. `Sidebar`
- Single panel component, structure-only (no auth assumptions, no hardcoded routes)
- Token-driven width, background, border
- Supports collapsed (icon-only) state via a `collapsed` prop

#### 3. `TopNav`
- Full-width horizontal bar; landmark `header` / `role="banner"`
- Token-driven background, height, shadow
- Slots: leading (logo/brand), center (optional), trailing (actions)
- Compound: `TopNav`, `TopNav.Leading`, `TopNav.Trailing` (and optionally `TopNav.Center`)

#### 4. `BottomTabs`
- Horizontal tab bar anchored to the bottom; landmark `nav` / `role="navigation"`
- Accepts an array of tab items (label, icon, onPress, active flag)
- Keyboard: arrow keys move between tabs; Enter/Space activates
- ARIA: `role="tablist"` with `role="tab"` children; `aria-selected` on active tab

#### 5. `Drawer`
- Slide-in overlay panel (left, right, top, or bottom via `placement` prop)
- Controlled: `open` + `onOpenChange`; also uncontrolled
- Focus trap while open; Escape and backdrop press close
- `role="dialog"`, `aria-modal="true"`, `aria-labelledby`
- Slide transition suppressed under reduced motion

#### 6. `CommandPalette`
- Modal overlay with a search input and a scrollable filtered results list
- Controlled: `open` + `onOpenChange` + `query` + `onQueryChange` + `items` + `onSelect`
- Keyboard: Arrow Up/Down navigates results; Enter selects; Escape closes
- Focus locked to palette while open; focus returns to trigger on close
- `role="dialog"`, `aria-modal="true"`, results list `role="listbox"`, each item `role="option"`

#### 7. `PageHeader`
- Horizontal layout: title (required), subtitle (optional), leading slot (icon/back button), trailing slot (actions)
- Token-driven typography and spacing
- Compound: `PageHeader`, `PageHeader.Title`, `PageHeader.Subtitle`, `PageHeader.Leading`, `PageHeader.Trailing`

---

### Group B — Content Containers

#### 8. `Section`
- Semantic section wrapper (`role="region"` with `aria-label` / `aria-labelledby`)
- Optional `title` and `description` sub-components
- Compound: `Section`, `Section.Title`, `Section.Description`, `Section.Content`
- Token-driven spacing and background

#### 9. `Card`
- Surface container; `role="article"` (non-interactive) or `role="button"` (interactive)
- States: default, hover, focused, active/pressed, disabled, loading/skeleton
- Interactive card: focusable via Tab, activated by Enter/Space
- Compound: `Card`, `Card.Header`, `Card.Content`, `Card.Footer`
- Token-driven: background, border, radius, shadow (resting + hover)
- Hover shadow/bg transition suppressed under reduced motion

#### 10. `StatCard`
- Displays a labeled metric value with optional trend indicator and icon
- Read-only; not interactive
- Compound: `StatCard`, `StatCard.Label`, `StatCard.Value`, `StatCard.Trend`, `StatCard.Icon`
- Trend prop accepts `up`, `down`, or `neutral` with token-driven color per direction

#### 11. `MetricTile`
- Compact version of StatCard; used in dense dashboard grids
- Label + value + optional delta; single-surface, no sub-sections
- Token-driven sizing (small / medium / large size variants)

---

### Group C — Data Display

#### 12. `DataTable`
- Accessible HTML table with `<table>`, `<thead>`, `<tbody>`, `<tr>`, `<th>`, `<td>` semantics
- Column definition prop: `columns: Array<{ key, header, render?, width? }>`
- Row data prop: `data: T[]`, `keyExtractor: (row: T) => string`
- Optional: sortable columns (`onSort`, `sortKey`, `sortDirection`)
- Optional: row selection with checkboxes (`selectedKeys`, `onSelectionChange`)
- Accessible: `scope="col"` on headers, `aria-sort` on sortable headers, `role="checkbox"` for selection
- Sticky header supported via `stickyHeader` boolean prop

#### 13. `DataGrid`
- CSS-grid–based alternative to DataTable for more flexible column layouts
- Same column/data/keyExtractor API as DataTable; renders via grid rows not HTML table
- Virtualization: when `virtualized` prop is true, only visible rows are rendered
- Sortable, selectable; accessible row labels via `aria-rowindex`, `aria-rowcount`

#### 14. `VirtualizedList`
- Render large lists efficiently; only visible items rendered
- Props: `data: T[]`, `renderItem: (item: T, index: number) => ReactNode`,
  `keyExtractor`, `estimatedItemHeight`
- Scroll container with `role="list"`; each rendered item `role="listitem"`
- Optional `onEndReached` + `onEndReachedThreshold` for infinite scroll

#### 15. `Pagination`
- Page number controls: Previous, page numbers (with ellipsis), Next
- Props: `page`, `totalPages`, `onPageChange`, optional `pageSize` + `onPageSizeChange`
- Keyboard: Tab to each page button; Enter/Space activates
- ARIA: `role="navigation"` with `aria-label="Pagination"`, `aria-current="page"` on active page
- Token-driven button sizes, colors, spacing

---

### Group D — Navigation & Disclosure

#### 16. `Breadcrumbs`
- Horizontal list of navigation crumbs with separators
- Props: `items: Array<{ label, href?, onPress? }>` — last item is current page (non-link)
- Semantic: `<nav aria-label="Breadcrumb">` wrapping an `<ol>` with `<li>` items
- Current page item has `aria-current="page"`
- Token-driven separator color, link color, current-page text color

#### 17. `Tabs`
- Horizontal or vertical tab strip with associated content panels
- Props: controlled (`value`, `onValueChange`) and uncontrolled (`defaultValue`)
- `orientation` prop: `horizontal` (default) | `vertical`
- Keyboard: Arrow Left/Right (horizontal) or Up/Down (vertical) move between tabs; Home/End jump to first/last
- ARIA: `role="tablist"`, `role="tab"`, `aria-selected`, `aria-controls`, content panels `role="tabpanel"` with `aria-labelledby`
- Compound: `Tabs`, `Tabs.List`, `Tabs.Tab`, `Tabs.Panel`

#### 18. `Accordion`
- Vertically stacked disclosure panels with header-trigger and collapsible content
- Props: `type` (`single` | `multiple`), controlled (`value`, `onValueChange`) and uncontrolled (`defaultValue`)
- `keepMounted` prop to preserve content DOM when closed (opt-in)
- Keyboard: Tab navigates headers; Enter/Space toggles; Arrow Up/Down/Home/End navigate headers
- ARIA: header buttons with `aria-expanded`, content regions `role="region"` with `aria-labelledby` and `aria-controls`
- Height animation for open/close, chevron rotation; both suppressed under reduced motion
- Compound: `Accordion`, `Accordion.Item`, `Accordion.Header`, `Accordion.Content`

---

### Group E — Resizable Layouts

#### 19. `ResizablePanel`
- Single panel with a drag handle on one edge to resize its dimension
- Props: `direction` (`horizontal` | `vertical`), `defaultSize`, `minSize`, `maxSize`,
  `onResize`
- Drag handle is keyboard-accessible: Arrow keys nudge the size
- ARIA: drag handle is `role="separator"` with `aria-orientation`, `aria-valuenow`,
  `aria-valuemin`, `aria-valuemax`
- Token-driven handle color, hover color, width/height

#### 20. `SplitView`
- Two-panel layout with a draggable divider between them
- Props: `direction` (`horizontal` | `vertical`), `defaultSplit` (percentage 0–100),
  `minSplit`, `maxSplit`, `onSplitChange`
- Compound: `SplitView`, `SplitView.Primary`, `SplitView.Secondary`
- Divider handle: same keyboard and ARIA requirements as ResizablePanel
- Token-driven divider appearance

---

## Testing Requirements (per component)

For each `.test.tsx`, cover:
- **Rendering**: all sub-components present; each sub-component individually omitted
- **Interaction**: all states (hover, focus, disabled, loading/skeleton where applicable)
- **Keyboard**: all key interactions per spec
- **Controlled vs uncontrolled**: state driven from outside vs. internal
- **Accessibility**: correct ARIA roles, labels, relationships, `aria-expanded`,
  `aria-selected`, `aria-current`, etc.
- **Theming**: renders in light and dark token contexts
- **Reduced motion**: animations suppressed when `prefers-reduced-motion: reduce`

Use `src/__test-utils__/` custom render (wraps `TamaguiProvider`) for all tests.

---

## Commit Strategy

Commit after each logical group (A → E) or after each component if the diff is large.
Follow Conventional Commits:

```
feat(layout): implement AppShell with sidebar toggle and landmark roles
feat(layout): implement Drawer with focus trap and reduced-motion support
feat(layout): implement Accordion (single/multi, controlled/uncontrolled)
...
```

All commits on a worktree branch; merge to `v2/scaffold` when the full module is complete.
